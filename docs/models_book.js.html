<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/book.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/book.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const mongoose = require("mongoose");

const bookSchema = new mongoose.Schema({
  title: {
    type: String,
    minLength: 1,
    maxLenght: 50,
    trim: true,
    required: true,
  },
  author: {
    type: String,
    minLength: 5,
    maxlength: 50,
    trim: true,
    required: true,
  },
  reviews: {
    type: Number,
    min: 0,
    default: 0,
  },
  reviewers: [String],
  description: {
    type: String,
    minLength: 15,
    maxLenght: 100,
    required: true,
  },
  stars: {
    type: new mongoose.Schema({
      one: {
        type: Number,
        min: 0,
        trim: true,
        default: 0,
      },
      two: {
        type: Number,
        min: 0,
        trim: true,
        default: 0,
      },
      three: {
        type: Number,
        min: 0,
        trim: true,
        default: 0,
      },
      four: {
        type: Number,
        min: 0,
        trim: true,
        default: 0,
      },
      five: {
        type: Number,
        min: 0,
        trim: true,
        default: 0,
      },
    }),
    required: true,
  },
});

/**
 * findBookByTitle retrieves a book by its title
 * @param{String} title - title of book
 * @returns{Object} - Book
 */
bookSchema.statics.findBookByTitle = async function (title) {
  const book = await this.findOne({ title });
  return book;
};

/**
 * createBook cretaes a book object and saves it in mongoDB
 * @param{Onject} bookData - object containing book info
 *  * @returns{Object} - newly created book
 */
bookSchema.statics.createBook = async function (bookData) {
  const book = new Book({
    title: bookData.title,
    author: bookData.author,
    description: bookData.description,
    stars: {},
  });
  await book.save();
  return book;
};

bookSchema.statics.getAllBooks = async function () {
  const books = await this.find();
  return books;
};

bookSchema.statics.getBookById = async function (id) {
  return await this.findById(id);
};

bookSchema.statics.updateBookById = async function (bookData, id) {
  const book = await this.findById(id);
  if (book) {
    for (let i in bookData) {
      book[i] = bookData[i];
    }
    await book.save();
    return book;
  }

  return false;
};

bookSchema.statics.deleteBookById = async function (id) {
  return await this.findByIdAndRemove(id);
};

bookSchema.statics.rateBookById = async function (data, bookId, userId) {
  const book = await this.findById(bookId);
  if (book) {
    const star = data.star;
    switch (star) {
      case 1:
        book.stars.one += 1;
        break;
      case 2:
        book.stars.two += 1;
        break;
      case 3:
        book.stars.three += 1;
        break;
      case 4:
        book.stars.four += 1;
        break;
      case 5:
        book.stars.five += 1;
        break;
    }

    book.reviews += 1;
    book.reviewers.push(userId);
    await book.save();
    return book;
  }

  return false;
};

bookSchema.statics.canRate = async function (bookId, userId) {
  const book = await this.findById(bookId);
  if (book) {
    const valid = book.reviewers.find((id) => userId === id);
    return valid;
  }

  return false;
};

const Book = mongoose.model("Book", bookSchema);

module.exports = {
  bookSchema,
  Book,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#authorize">authorize</a></li><li><a href="global.html#handleFunc">handleFunc</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#options">options</a></li><li><a href="global.html#registerUser">registerUser</a></li><li><a href="global.html#sendJSONResponse">sendJSONResponse</a></li><li><a href="global.html#validate">validate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Fri Apr 10 2020 18:06:23 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
